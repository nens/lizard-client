<div class="animate-repeat">

  <cardheader ng-if="header" geom="geom"></cardheader>

  <div
    ng-if="showNoData && header"
    class="card active card-content">
    <em translate>No data available for this location</em>
  </div>

  <rain
    ng-if="geom.properties.rain && (geom.id || geom.geometry.type !== 'Polygon')"
    rain="geom"
    time-state="timeState">
  </rain>

  <annotations
    ng-if="header && geom.geometry.type === 'Point'"
    data="geom"
    time-state="timeState">
  </annotations>

  <defaultpoint
    ng-if="geom.geometry.type === 'Point' && !geom.properties.rain && slug !== 'annotations'"
    ng-repeat="(slug, content) in geom.properties"
    content="content"
    name="slug"
    state="omnibox.state">
  </defaultpoint>

  <div
    ng-if="geom.geometry.type === 'LineString' && (content.scale === 'interval' || content.scale === 'ratio')"
    class="card active card-content"
    ng-repeat="(slug, content) in geom.properties">

    <graph
      line
      mouseloc="mouseloc"
      temporal="timeState"
      data="content.data"
      ylabel="content.quantity + ' [' + content.unit + ']'"
      xlabel="'Afstand in [m]'">
    </graph>

    <div class="card-tools">
       <a
         class="btn btn-default btn-xs"
         title="<% 'Export info card data' | translate %>"
         ng-csv="formatLineCSV(slug, content)"
         field-separator=";"
         filename="<% slug %>.csv"
         csv-header="getLineCSVHeaders(slug, content)">
         <i class="fa fa-share-square-o"></i>
         <span translate>Export</span>
      </a>
    </div>
  </div>

  <div
    ng-if="content.data
    && (geom.geometry.type === 'Polygon' || geom.geometry.type === 'MultiPolygon')
    && slug !== 'rain'"
    ng-repeat="(slug, content) in geom.properties"
    class="card active">

    <div class="card-content">

      <div ng-if="content.format === 'Vector' && slug !== 'annotations'">
        <span class="card-title">
          <span><i class="fa fa-circle" ng-style="{'color': content.color }"></i></span>
          <span><% content.data.length %></span>
          <span><% content.quantity %></span>
        </span>
        <full-details class="table-details-toggler"></full-details>
        <table ng-if="fullDetails" class="table table-hover table-condensed" >
          <tbody>
            <tr ng-repeat="event in content.data">
              <td rel="tooltip"
                  data-placement="left"
                  title="<% 'Start' | translate %>: <% event.properties.timestamp_start | date:'dd/MM/yyyy' %>
                         <% 'End' | translate %>: <% event.properties.timestamp_end | date:'dd/MM/yyyy' %>">
                  <% event.properties.timestamp_start | date:'dd/MM/yyyy' %>
              </td>
              <td rel="tooltip"
                  data-placement="left"
                  title="<% event.properties.category %>">
                  <% event.properties.category %>
              </td>
              <td rel="tooltip"
                  data-placement="left"
                  title="<% event.properties.value %>">
                  <% event.properties.value | truncate:17 %>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <graph
        ng-if="content.aggType === 'curve'"
        line
        xlabel="'[%]'"
        ylabel="content.unit"
        data="content.data"
        keys="{x: 0, y: 1}">
      </graph>

      <graph
        ng-if="content.aggType === 'histogram'"
        bar-chart
        quantity="'linear'"
        ylabel="'[%]'"
        xlabel="content.unit"
        data="content.data"
        keys="{x: 0, y: 1}">
      </graph>

      <graph
        ng-if="content.aggType === 'counts'"
        horizontal-stack
        data="content.data"
        keys="{x: 'data', y: 'label'}"
        xlabel="'[%]'"
        dimensions="{height: 80, padding: {left: 0, right: 0, top: 5, bottom: 50 } }">
      </graph>

      <div ng-if="content.aggType !== 'histogram' && content.aggType !== 'curve' && content.aggType !== 'counts'">

        <graph
          ng-if="content.format === Store"
          line
          data="content.data">
        </graph>

      </div>

    </div>

  </div>
</div>
